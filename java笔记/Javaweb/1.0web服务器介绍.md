### a.web服务器的工作原理

HTTP协议基于TCP协议上，是一个应用层协议，用于用户代理和Web服务器进行通信。Web服务器通常采用一问一答的方式进行工作：

1. 在用户代理上用户发起资源请求，请求内容包括但不限于：指定资源的唯一标识URI,指明动作类型（GET/POST/DELETE/PUT...）
2. 用户代理解析用户输入URI并从中获取目标域名，交由DNS服务器解析。如果URI中指定某IP地址，这无需这步。
3. 如果与服务器的会话还没建立，此时先建立TCP连接，并完成HTTP协商（确定双方均可接受的处理方式，包括协议版本，是否加密，内容格式等等）。
4. 用户代理把请求内容封装成HTTP数据包向服务器发送。
5. 服务器接收到资源请求并以之前协商好的方式解包并处理。
6. 服务器请求的资源封装成HTTP数据包并返回给用户代理。



### b.服务器端的工作原理

- TCP监听模块

  服务器监听某个端口（一般默认是8080端口，用户可以设置其他端口），以建立和用户代理之间的连接。一旦建立连接，用户代理的后续HTTP请求将不用再进入监听模块。

- 预处理

  此处主要做三件事：1. 从TCP报文中获取HTTP请求报文。 2. 根据和用户代理的协商进行解密，解压，安全处理等等。3. 根据服务器自身的配置进行安全处理，建立会话状态等等。

- UR路由

  解析URL字符串和动作以确定用户代理请求的资源，根据匹配规则（通常根据正则表达式+后缀）路由到静态资源处理模块或动态资源处理模块。

- 静态资源处理模块

  负责找到静态资源，比如HTML/Javascript/CSS文件/图片/图像，确定内容是字符流或者字节流，并确定对应MIME,比如HTML生成MIME为text/html的字符流，mpeg视频文件生成MIME为video/mpeg的字节流。

- 动态资源处理模块

  运行业务逻辑处理，动态决定返回的资源内容和类型，内容和类型的处理原则同上。

- 后处理

  根据和用户协商的协议进行加密，压缩，安全处理等等。

- 资源输出模块

  把处理好的内容和类型封装成HTTP报文，往TCP连接另一头的用户代理发送TCP报文（内容是HTTP报文）。



### c.web应用程序容器（服务器）的诞生

随后Web服务器朝着企业级应用方向发展，快速的业务变化，迫使Web开发人员面对新的挑战：如何快速写出鲁棒，可靠，符合业务需求的程序并顺利部署？解决这个挑战的一个有效的办法是，创造一个Web程序开发框架（含运行环境，比如解释执行JSP,Web API），这个框架解决鲁棒性，可靠性问题，提供快速开发接口。换言之，开发人员只需要专注于实现业务本身，如有更高的需求还可以对框架进行定制和扩展。这个框架的另外一个名字是Web应用程序容器。

相对于web服务器，该容器新增或强化了以下几部分：

- 分配线程池资源

  容器为每个请求分配一个线程进行处理，通常采取线程池的方式高效理由CPU算资源。

- 封装Request上下文

  一个请求对应一个Request上下文，它主要封装了用户请求的主要构成：URL,HTTP请求头，以及基于请求头构建的Session,Cookie等对象，方便编程使用。

- 封装Response上下文

  一个请求对应一个Response上下文，主要用于向用户代理返回资源。可以在其中写入输出流，或者重定向，或者返回错误码等等。

- URL路由

  在容器里，运行开发人员设置不同的路由匹配规则，比如让.HTM返回.HTML,也可以自定义.xyz返回.HTML资源。更加灵活的配置可以参考JAVA MVC或者ASP.NET MVC的配置方案。

- 动态资源处理模块

  通常在这里具体的容器和开发语言都有自己的高效开发模型，比如JAVA的Servlet,ASP.NET的Web Form,MVC。

- 回收资源

  这里会回收刚才的线程资源，为了线程复用，除非服务器空闲一般会将线程返回线程池。

  可以看出,Web容器本身具备了做为一个Web服务器的功能,事实上通常实现Web容器功能的服务器就是一个Web服务器.比如Tomcat , IIS ,Jetty。



随着web服务器的发展，web服务器与应用程序服务器的界限越来越模糊，但是还是要区分开来。

当有人说到“web服务器”时，你通常要把它认为是以HTTP为核心、web UI为向导的应用。当有人说到“应用服务器”时，你可能想到“高负载、企业级特性、事务和队列、多通道通信（HTTP和更多的协议）”。但现在提供这些需求的基本上都是同一个产品。



从概念上讲：Web服务器是提供WWW服务的程序；Web容器是提供给开发者的框架；Web应用程序服务器内容丰富得多，既可用各厂商通常遵循一定的工业标准并自定义扩展功能而成，也可以利用开源组件轻量级拼装打造

文章链接：[一文看懂web服务器、应用服务器、web容器、反向代理服务器区别与联系 - 帅虫哥 - 博客园 (cnblogs.com)](https://www.cnblogs.com/vipyoumay/p/7455431.html#111-web服务器的历史)

