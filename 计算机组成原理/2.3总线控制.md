# 一、总线判优控制

1.基本概念

* 主设备（模块）：对总线有控制权
* 从设备（模块）：响应从这设备发来的总线命令
* 总线判优控制：
  * 集中式
    * 链式查询
    * 计数器定时查询
    * 独立请求方式
  * 分布式



## 1.集中式之链式查询

<img src="/Users/jared/Library/Application Support/typora-user-images/image-20211117194652905.png" alt="image-20211117194652905" style="zoom:50%;" />

解释：

​	接口1和接口n向BR总线发出占用请求，收到占用请求以后，总线控制部件通过BG总线遍历查询是哪个部件发出的占用请求，查到第一个发送出占用请求的接口1后，接口1通过BS总线向总线控制器发出占用，接口1则获得控制权



## 2.集中式之计数器定时查询方式

<img src="/Users/jared/Library/Application Support/typora-user-images/image-20211117200141213.png" alt="image-20211117200141213" style="zoom:50%;" />

总线控制部件内部有一个计数器，默认初始值为0，当通过设备地址总线逐个查找的时候，如果设备没有发出总线占用请求，那么计数器加1。可以通过某种方式给计数器设置初始值，就可以表示从第几个设备开始向下逐个查询



## 3.集中式之独立请求方式

<img src="/Users/jared/Library/Application Support/typora-user-images/image-20211117200541783.png" alt="image-20211117200541783" style="zoom:50%;" />

每个部件和总线控制部件都有独立的线连接。当请求发送给控制部件的时候，可以自定义排队器的规则，对请求进行排序



# 二、总线通信控制

1. 目的：解决通信双方协调配合问题
2. 总线传输周期
   * 申请分配阶段：主模块申请，总线仲裁决定（即总线判优）
   * 寻址阶段：主模块向从模块给出地址和命令
   * 传数阶段：主模块和从模块交换数据
   * 结束阶段：主模块撤销有关信息
3. 总线通信的四种方式
   * 同步通信：由统一时标控制数据传送
   * 异步通信：采用应答方式，没有公共时钟标准
   * 半同步通信：同步、异步结合
   * 分离式通信：充分挖掘系统总线每个瞬间的潜力

## 1.同步式数据输入

在第一个时钟周期的上升沿，主设备发出地址；在第二个上升沿，主设备发出读命令（告诉从设备主设备要从你从设备读取数据了）；在到达第三个时钟周期的上升沿之前，从设备必须要给出数据信号到数据总线；第四个时钟周期的上升沿，数据信号和控制信号开始撤销，直到第四个时钟周期的结束，地址信号也撤销了。地址信号会多保留一个时钟周期

![image-20211117205632165](/Users/jared/Library/Application Support/typora-user-images/image-20211117205632165.png)



## 2.同步式数据输出

在第一个时钟周期的上升沿，给出地址信号，在第一个时钟周期的下降沿，要给出数据；在第二个时钟周期的上升沿，要给出写命令，向从设备进行数据写入；一直写到第四个时钟周期的上升沿；在第四个时钟周期的上升沿，数据信号和控制信号开始撤销，直到第四个时钟周期的结束，地址信号也撤销了。地址信号会多保留一个时钟周期

![image-20211117205648962](/Users/jared/Library/Application Support/typora-user-images/image-20211117205648962.png)



## 3.异步通信

举个例子，主设备喊从设备一声，

不互锁：主设备不管从设备听没听到，只喊一声，从设备如果听到了，就应一声，不管主设备有没有听到它的应答。

互锁：主设备喊了一声，发现从设备没应答，他就继续喊，直到从设备应答，但从设备不管主设备有没有接收到应答，它只应答一次

全互锁：从设备要确认主设备接收到应答后才断开连接

![image-20211117205845107](/Users/jared/Library/Application Support/typora-user-images/image-20211117205845107.png)

## 4.半同步通信（同步、异步）

同步：

* 发送方用系统时钟前沿发信号
* 接收方用系统时钟后沿判断、识别

异步：

* 允许不同速度的模块和谐工作
* 增加一条等待响应信号

![image-20211117212214551](/Users/jared/Library/Application Support/typora-user-images/image-20211117212214551.png)

## 5.分离式通信

充分挖掘系统总线每个瞬间的潜力。

由上面几种通信方式看出，从设备在准备数据时，总线是空闲的。

分割一个总线传输周期：

* 子周期1：主模块申请占用总线，使用完后即放弃总线的使用权
* 子周期2：从模块申请占用总线，将各种信息发送至总线上

特点：

1. 各模块有权申请占用总线
2. 采用同步方式通信，不等待对方回答
3. 各模块准备数据时，不占用总线
4. 总线被占用时，无空闲