# 高速缓冲存储器

1.为什么要使用cache？

CPU和主存的速度不匹配，为了避免CPU出现”空等“的现象，就需要一个中间高速存储器来解决这个问题。也就是Cache。

它利用的是程序访问的局部性原理。

指程序在执行时呈现出局部性规律，即在一段时间内，整个程序的执行仅限于程序中的某一部分。相应地，执行所访问的存储空间也局限于某个内存区域

（1）时间局部性

时间局部性是指如果程序中的某条指令一旦执行，则不久之后该指令可能再次被执行；如果某数据被访问，则不久之后该数据可能再次被访问

（2）空间局部性

空间局部性是指一旦程序访问了某个存储单元，则不久之后，其附近的存储单元也将被访问。

<img title="" src="file:///Users/jared/Library/Application%20Support/marktext/images/2021-12-11-12-03-07-image.png" alt="" width="523">

2.Cache的工作原理

**（1）主存和缓存的编址**

![](/Users/jared/Library/Application%20Support/marktext/images/2021-12-11-12-09-36-image.png)

主存和缓存都是按块存储，块的大小相同，B为块长

从图中可以看出，主存、缓存分别被划分为了m块和c块，但是m>>c，而缓存中的标记是用来表示是主存的哪一块被存到了这里。

**（2）命中与未命中**

命中是指：主存块调入缓存，主存块与缓存块建立了对应关系（说白了就是CPU在缓存中找到了想使用的指令/数据，不用再在主存中去取）

未命中就是它的反义词了。

**（3）Cache的命中率**

CPU欲访问的信息在cache中的比率。（假设CPU总共访问n+m次，n是访问cache，m是访问主存的，那么命中率为n/(n+m)）

命中率与Cache的容量与块长有关。一般每块可取4-8个字，而块长取一个存取周期内从主存调出的信息长度（16体交叉，块长取16个存储器，4体交叉，取4个存储字）

**（4）Cache——主存系统的效率**

效率e与命中率有关

e=访问Cache的时间/平均访问时间*100%

设Cache命中率为h，访问Cache的时间为Tc，访问主存的时间为Tm，则平均访问时间为：(hTc+(1-h)Tm)，所以

$e=Tc/(hTc+(1-h)Tm)$

3.Cache的基本结构

![](/Users/jared/Library/Application%20Support/marktext/images/2021-12-11-13-00-19-image.png)

4.Cache的读写操作

![](/Users/jared/Library/Application%20Support/marktext/images/2021-12-11-13-00-42-image.png)

读：![](/Users/jared/Library/Application%20Support/marktext/images/2021-12-11-13-01-10-image.png)

写：Cache和主存的一致性

- 写直达法：
  
  - 写操作时数据既写入主存，又写入Cache，写操作时间就是访问主存的时间，Cache块退出时不需要对主存执行写操作，更新策略比较容易实现。缺点：有可能造成CPU对同一个单元进行多次读写

- 写回法
  
  - 写操作时只把数据写入Cache而不写入主存，当cache数据被替换出去时才写回主存
  
  - 写操作时间就是访问Cache的时间
  
  - Cache块退出时，被替换的块写回主存，增加了Cache的复杂性
  
  - 并且如果是多个主存的话，就会有多个cache，主存之间的数据一致性也是一个问题

5.Cache的改进

（1）增加Cache的级数

    片载（片内）Cache

    片外

（2）统一缓存和分立缓存

指令Cache，数据Cache，与指令执行的控制方式有关
