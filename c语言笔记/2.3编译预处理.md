# 编译预处理

预处理命令是用来通知C语言编译系统在对源程序编译之前应该做哪些预处理工作。

预处理的功能主要有三种：

1. 宏定义
2. 文件包含
3. 条件编译

预处理命令均已#开头，占独立的一行，且语句结尾不用分号;结束



## 宏定义

指用一个指定的标识符来定义一个字符序列，根据宏定义是否有参数将宏定义分为两种：不带参数的宏定义与带参数的宏定义

在预编译时将宏名替换为字符串的过程称为”宏展开”

1. 不带参数的宏定义
   用一个指定的标识符（宏名）来表示一个字符串，字符串可以是常量，格式串，表达式等。(相当于定义一个全局常量)
   格式：`#define 标识符 字符串`

   说明：
   （1）宏名的有效范围是从定义命令之后到文件结束，可以用`#undef`来终止宏定义
   （2）如果程序中出现与宏名相同的变量名，但是它被双引号括起来，则他并不会被进行宏替换
   （3）宏定义时并不进行语法检查

2. 带参数的宏定义

   C语言允许宏带有参数，在宏定义中的参数被称为形式参数。带参数的宏定义不是进行简单的字符串替换，而是进行参数替换。
   格式：`#define 标识符(形式参数列表) 字符串`

   说明：

   （1）宏定义的实际参数和形参的数据类型是不受限制的，但是函数的会受到限制；

   （2）宏展开时系统并不会分配内存单元，宏展开也没有返回值的概念

   （3）多次使用宏，宏展开后源程序会增长，但是函数调用则不会使源程序增长

   （4）函数只能有一个返回值，而宏可以设法得到多个值

   ```c
   #define SUM(a,b) (a+b)
   #define Change(x,y) {int c;c=a;a=b;b=c}
   
   int main() {
     int x=3,y=5;
     Change(x,y);
     printf("%d %d", x, y);
     // 结果是5,3。为啥和自己定义的函数实现的结果不一样呢？
     // 因为这个宏定义实际是把实参带进去进行操作，而定义的函数使用形参进行操作。所以宏定义可以不用指针实现值的替换
     return 0;
   }
   ```



## 文件包含处理

文件包含处理是指将一个源文件将另一个源文件的全部内容包含进来

一般形式为：`#include <文件名>` 或`#include "文件名"`，前面一种多使用于系统的库文件，后面多使用于自定义的源文件



## 条件编译

有时希望部分代码是在满足一定条件时才进行编译，形成目标代码。此种对程序的一部分内容指定编译的条件称为条件编译

条件编译命令有三种形式：

(1)第一种

```c
#ifdef 宏名
	程序段1 
#else
  程序段2
#endif
  或

#ifdef 宏名
	程序段1 
#endif
// 判断宏名在此之前是否被定义过，若定义过，则编译程序1    
```

（2）第二种

```c
#ifndef 宏名
	程序段1 
#else
  程序段2
#endif
  或

#ifndef 宏名
	程序段1 
#endif
// 与第一种类似，ifndef与ifdef作用相反（if not)
```

(3)第三种

```c
#if 表达式
	程序段1 
#else 表达式
  程序段2
#endif
  或

#if 表达式
	程序段1 
#endif
```

示例

```c
#include<stdio.h>
        #define Flag 1
        void main()
        {
            float r,s,l,v;
            scanf("%f",&r);
            #if Flag
            #define PI 3.1415926
            #else
            #define PI 3.14
            #endif
            s=PI＊r＊r;
            l=2＊PI＊r;
            v=4.0/3＊PI＊r＊r＊r;
            printf("l=%0.4f,s=%0.4f,v=%0.4f\n",l,s,v);
        }
```

