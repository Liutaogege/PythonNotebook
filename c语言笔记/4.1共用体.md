

# 共用体

共用体又称联合体，它和结构体一样，也是一种由用户自己定义的数据类型，由若干个成员数据组成。成员的数据类型可以是相同的，可以是不同的，共用体与结构体的不同之处在于共用体的所有成员都占用相同的内存，使用共用体可以节省内存。

共用体共享存储空间不是多个成员同时装入一个共用体变量内，而是指该共用体变量可以被赋予任一成员值，每次只能赋一种值，赋入新增取代旧值。

上面的意思是说，定义了一个共用体变量后，相当于新增了一种特殊的变量类型，这个变量的具体类型是由它所包含的成员来决定的。如果给他赋值成员1的值，在类型是1的类型，如果给他赋成员2的值，则是类型为2的类型，并且该成员2会替换掉原来的成员1。（可以看成是万能变量，其值和类型由赋予的值来决定（当然还有定义的值））

定义格式如下：

```c
union 共用体名
{
  数据类型1 成员1名;
  数据类型2 成员2名;
  ...
}
```

==注意==：

（1）不能对共用体变量名赋值，不能试图引用变量名来得到一个值，==也不能在定义共用体变量的时候对他进行初始化。==

（2）不能把共用体变量作为函数参数，也不能是函数带回共用体变量，但可以使用指向共用体变量的指针。

（3）共用体数组元素来引用其成员，引用格式如下：`共用体数组名[下标].成员名`

（4）共用体指针变量引用该共用体的变量或数组，格式如下：

```c
共用体指针变量=&共用体变量名
共用体指针变量=&共用体数组名[下标]
共用体指针变量=共用体数组名
```

（5）共用体指针变量引用共用体的的成员，格式如下：

```c
(*共用型指针变量).成员名
共用型指针变量->成员名
```





# 共用体的定义

第一种：先定义共用体，再定义共用体变量、数组及指针变量

```c
union 共用体名
{
  数据类型1 成员1名;
  ...
}
union 共用体名 变量名,共用体数组名[数组长度],*共用体指针变量名;

union share {
  int age;
  float money;
  char name[10];
}
// 不能进行初始化
union share a,b[5],*p;

```



第二中：定义共用体的同时定义共用体变量、数组及指针变量

```c
union 共用体名
{
  数据类型1 成员1名;
  ...
}变量名,共用体数组名[数组长度],*共用体指针变量名;


union share {
  int age;
  float money;
  char name[10];
}a,b[5],*p;
```



第三种:定义共用体变量、数组及指针变量时省略共用体名

这种格式其实根第二种格式相似，只是把共用体名省略了,以后就不能再以它定义共用体变量了。

```c
union
{
  数据类型1 成员1名;
  ...
}变量名,共用体数组名[数组长度],*共用体指针变量名;
```



示例：

```c
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

struct student {
    int num;
    char name[20];
    struct student *p;
};

union share {
    int age;
    float money;
    char name[20];
};

int main() {
    union share tom;
    tom.age=26;
    printf("%d\n", tom.age);
    // 赋新值以后，原值就会消失，如果是同一类型，则它们值相同，因为指向同一个内存地址
    tom.money=6000.0;
    printf("%f %d", tom.money, tom.age);
    return 0;
}
```

