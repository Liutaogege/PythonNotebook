# 文件

在程序中使用文件名的时候需要将文件名存储的全部路径写下来，有时可以将其中的一部分省略掉。

（1）省略盘符表示在当前盘的指定路径下寻找文件：`web\program.txt`

（2）省略路径表示在指定盘的当前路径下寻找文件，如`D:program.txt`
（3）同时省略掉盘符和路径，表示在当前盘，当前路径下寻找文件，如`program.txt`



由于处理数据只能在内存中而不能直接在磁盘上进行操作，因此只有把磁盘上文件中的数据读取到内存中，然后再做修改，最后再将内存中的数据存回到磁盘上。

为了解决高速的内存读写与低俗外部设备之间的矛盾，通常在内存中开辟一个区域，即文件缓冲区。在向这个文件缓冲区读写的时候有一个标识这个文件缓冲区的地址，即指向文件缓冲区的文件结构型指针。

==文件型是一种特殊的结构体==，该结构体用来存放文件的有关信息。该结构体类型是由系统进行定义的，取名为“FILE"，对FILE这个结构体类型的定义是在stdio.h头文件中。（不同环境的的结构体定义可能不同）。

只要程序用到一个结构体变量，系统就为此文件开辟一个结构体变量（有几个开几个），用来存放各个文件的有关信息。这些结构体变量通过指向结构体类型的指针变量去访问。即==”文件指针"==

![image-20211002074636956](/Users/jared/Library/Application Support/typora-user-images/image-20211002074636956.png)

## 文件指针

定义 ：`FILE *文件指针变量名`;  使用FILE必须引入stdio.h头文件



## 文件的打开与关闭

对文件进行读写之前必须先打开文件，使用以后都要关闭该文件。利用系统函数来实现，文件打开函数fopen()和文件关闭函数fclose()。

使用：`fp=fopen(filename, mode);` `fclose(fp);`

fclose返回一个值，若顺利关闭，则返回值为0，若未正确关闭，则返回值为非0，可以用ferror()函数来测试。

关闭的过程：将缓冲区中尚未存盘的数据写盘，然后撤销存放该文件信息的结构体，最后令指向该文件的指针为空值（NULL)



**mode格式有如下几种（同python）**

```C
r打开只读文件，该文件必须存在，否则报错。

w 打开只写文件，若文件存在则重写文件,若文件不存在则建立该文件。
  
a 以附加的方式打开只写文件。若文件不存在，则会建立该文件，如果文件存在，写入的数据追加到文件尾，(EOF符保留)
  
r+ 打开一个存在的文件，该文件必须存在，否则报错。

W+ 打开可读写文件，若文件存在则重写文件。若文件不存在则建立该文件。
  
a+ 以附加方式打开可读写的文件。若文件不存在，则会建立该文件，如果文件存在，写入的数据追加加到文件尾(原来的EOF符不保留)

wb 只写方式打开或新建一个二进制文件， 只允许写数据。

wb+ 读写方式打开或建立一个二进制文件，允许读和写。

rb+读写方式打开一个二进制文件，只允许读写数据。

ab+ 读写打开一个二进制文件，允许读或在文件末追加数据。
```





## 文件的读写操作

1.读取字符函数fgetc()

格式：`fgetc(文件指针)`

从文件指针所指向的文件中读取一个字符，如果读取正确则返回该字符，若错误或者读到文件结尾，就返回EOF标志。

使用EOF标记来判断文件是否结束，只适用于ASCII码文件，因为ASCII码文件中没有-1字符，而二进制文件中可能含有-1，此时就不能使用EOF作为文件的结束标志，使用feof函数来判断文件是否结束。

2.写入字符函数fputc()

格式：`fputc(字符, 文件指针变量);`

输出成功，则返回值就是该字符，输出失败返回EOF(-1)