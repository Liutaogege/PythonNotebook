# Docker常用命令

## 帮助命令

```
docker version    # 版本信息
docker info       # 更详细的信息
docker --help     
```

#### 帮助文档

文档地址：[Docker Desktop overview | Docker Documentation][Reference documentation | Docker Documentation](https://docs.docker.com/reference/)



## 镜像命令

docker images  查看所有本地的主机上的镜像

docker images --help  查看该命令的帮助

```
[root@VM-0-10-centos ~]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    d1165f221234   5 months ago   13.3kB

# 解释
REPOSITORY 		镜像的仓库源
TAG						镜像的标签
IMAGE ID      镜像ID
CREATED       镜像创建时间
SIZE          镜像大小

# 可选项
			-a，--all     列出所有的镜像
			-q，--quiet    只列出镜像的ID
```

**docker search** 查找镜像命令

他的本质就是在docker hub中寻找，所以可以到官网寻找，里面有更详细的介绍：[Explore Docker's Container Image Repository | Docker Hub](https://hub.docker.com/search?q=mysql&type=image)

```
[root@VM-0-10-centos ~]# docker search mysql
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                             MySQL is a widely used, open-source relation…   11299     [OK]
mariadb                           MariaDB Server is a high performing open sou…   4292      [OK]

# 可选项
		-f, --filter    过滤选项
		docker search mysql -f STARS=4000   表示查找星星在4000以上的
```



**docker pull     下载镜像**

```
# 下载指定版本镜像 docker pull 镜像名[:tag] 
[root@VM-0-10-centos ~]# docker pull mysql
Using default tag: latest                # 如果不写tag，默认就是latest
latest: Pulling from library/mysql
e1acddbe380c: Pull complete              # 分层下载，docker images的核心，联合文件系统
bed879327370: Pull complete
03285f80bafd: Pull complete
ccc17412a00a: Pull complete
1f556ecc09d1: Pull complete
adc5528e468d: Pull complete
1afc286d5d53: Pull complete
6c724a59adff: Pull complete
0f2345f8b0a3: Pull complete
c8461a25b23b: Pull complete
3adb49279bed: Pull complete
77f22cd6c363: Pull complete
Digest: sha256:d45561a65aba6edac77be36e0a53f0c1fba67b951cb728348522b671ad63f926  # 签名
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest           # 真实地址

# 以下两条命令是等价的：
		docker pull mysql
		docker.io/library/mysql:latest
		
# 文件联合系统指的是：
		当下载多个版本的镜像时，由于docker是分层下载，所以不同的版本有些层级是可以共用的，这样可以极大的节省内存
```



**docker rmi 删除镜像** 

```
docker rmi 镜像ID或名称
docker rmi -f $(docker images -aq)  强制删除所有的镜像（$()表示这是一个参数）
```



## 容器命令

**说明：安装容器之前要先有容器才行**

**新建容器并启动**

```
docker run [可选参数] image

# 可选参数说明
	--name=“Name”  容器的名字
	-d						 后台方式运行
	-it						 使用交互方式运行，就是进入容器
	-p							指定容器的端口， -p  8080:8080
				-p		ip:主机端口：容器端口
				-p		主机端口：容器端口 (最常用)
				-p    容器端口（不映射出去)
				容器端口
  -P              随机指定端口

# 测试运行centos镜像：启动并进入容器，并给容器命名为test1
[root@VM-0-10-centos ~]# docker run --name test1 -it centos /bin/bash
[root@14b9b14a7e0a /]# ls       # 此时查看的是容器内部的文件，基础版本，很多命令都不完整
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

# 退出容器回到主机
		exit
		
```

**docker ps   列出容器**

```
docker ps             列出正在运行的容器

# 可选参数说明：
-a，--all					列出所有的容器（包含历史运行过的）
-n=？							显示最近创建的n个容器
-q								只显示容器的编号
-l								显示最新创建的容器
```

**退出容器**

```
exit							直接退出容器，容器会停止运行
ctrl + p + q      退出容器但不停止
```

**docker rm 删除容器**

```
docker rm 容器ID          不能删除正在运行的容器，除非加上-f
docker rm -f $(docker ps -aq)			删除所有的容器
docker ps -a -q | xargs docker rm  删除所有的容器
```

**启动和停止容器的操作**

```
docker start 容器id				# 启动容器
docker restart 容器id			# 重启容器
docker stop 容器id				# 停止当前正在运行的容器
docker kill 容器id				# 强制停止当前的容器
```



# 常用的其他命令

**后台启动容器**

```
# docker run -d 镜像名
[root@VM-0-10-centos ~]# docker run -d centos

# 坑：当你像上面一样后台启动，使用docker ps命令发现并没有正在运行的容器
# 解释：这是因为docker容器使用后台运行，就必须要有一个对应的前台进程，如果没有，docker发现没有前台应用，就会自杀
# 比如：nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了
# 解决办法：使用这个命令
[root@VM-0-10-centos ~]# docker run -itd centos /bin/bash
```



**查看日志**

```
docker logs OPTIONS 容器ID

# 可用选项：
-f，--follow         跟踪日志并打出
-n，--tail           从末尾算起显示出多少条日志
-t,--timestamps      时间

docker logs -tfn 10 732b632820e8

# 没有日志的话，可用自己写一个脚本来生成
[root@VM-0-10-centos ~]# docker run -itd centos /bin/bash -c "while true;do echo liutao;sleep 1;done"

```

**查看容器中进程信息 ps**

```
docker top 容器ID
[root@VM-0-10-centos ~]# docker top 732b632820e8
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                25163               25146               0                   10:05               pts/0               00:00:00            /bin/bash -c while true;do echo liutao;sleep 1;done
root                26097               25163               0                   10:08               pts/0               00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1
[root@VM-0-10-centos ~]#

```

**查看镜像的元数据**

```
docker inspect 镜像ID
```

**进入当前正在运行的容器**

```
# 容器通常都是使用后台方式运行的，有时会需要进入容器进行一些配置修改
# 方式一：
  docker exec -it 容器ID BASHSHELL
  比如：docker exec -it 容器ID /bin/bash，		docker exec -it 容器ID /bin/sh

# 方式二：
	docker attach 容器ID
	与上面的区别：他进入的是容器内部正在运行命令的窗口，而上面相当于是容器内部新建一个窗口
	
```

**从容器内拷贝文件到主机上**

```
docker cp 容器ID:容器内路径 主机路径
[root@VM-0-10-centos home]# docker cp c1c39bb8a958:/test.java /home

# 拷贝是一个手动过程，未来使用-v卷的技术，可以实现自动同步复制到主机上
```

# 命令总结

```
attach				# 当前shell下attach连接指定运行镜像
build					# 通过docekrfile定制镜像
commit				# 提交当前容器为新的镜像
cp						# 从容器中拷贝指定文件或者目录到主机中
create				# 创建一个新的容器，同run但是不启动容器
diff					# 查看容器的变化
events				# 从docker服务中获取容器实时事件
exec					# 进入容器
export				# 导出容器的内容流作为一个tar归档文件（对应import
history				# 展示一个镜像形成历史
images
import				# 从tar包中的指定内容创建一个新的文件系统映象（对应export
info					# 查看docker系统相关信息
inspect				# 查看容器或者镜像详细信息
kill					# 强制停止一个镜像
load					# 从一个tar包中加载一个镜像对应save
login					# 注册或者登录一个docker源服务器
logout				# 从当前docker registry退出
logs					# 容器日志信息
post          # 查看映射端口对应的容器内部源端口
pause					# 暂停容器
pull
push					# 推送指定镜像或者库镜像至docker源服务器
restart
save					# 保存一个镜像为一个tar包，对应load
search				# 在docker hub中搜索镜像
start					# 启动容器
stop					# 停止
tag						# 给源中镜像打标签
top						# 查看容器中的进程信息
unpause				# 取消暂停容器
version
wait					# 截取容器停止时的退出状态
volume        # 查看卷
```

