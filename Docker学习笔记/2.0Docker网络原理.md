# Docker网络

## 理解Docker0

查看网络命令：ip addr

![image-20210824121848270](/Users/jared/Library/Application Support/typora-user-images/image-20210824121848270.png)

> docker是如何处理容器网络访问的？

以下是实战：

```
# 1.先运行一个Tomcat镜像容器
docker run -d -P --name tomcat01 tomcat

# 2.查看容器内的内部网络地址
docker exec -it 容器id ip addr
以上命令等价于（docker exec -it 容器id /bin/bash,再执行ip addr)
查看结果如下：

# 发现容器启动的时候会得到一个eth0@if511,这个ip地址是docker分配的。而且主机是可以ping通这个容器的ip地址
```

![image-20210824122904036](/Users/jared/Library/Application Support/typora-user-images/image-20210824122904036.png)



> 原理

1.每当启动一个docker容器，docker就会给docker容器分配一个ip，只要安装了docker，就会有一个docker0桥接模式，使用的技术是evth-pair技术。

​	使用该技术就意味着：当新起一个容器时，就会出现一对新的网卡。这一对网卡就是一对虚拟设备接口，一连着协议，一端彼此相连。

2.因此，容器和容器之间也是可以相互ping通的，他们ping通的原理图如下：

![image-20210824125101180](/Users/jared/Library/Application Support/typora-user-images/image-20210824125101180.png)

由图可知，容器之间并不是直接连通的，而是通过docker0进行转接的。

tomcat01和tomcat02是公用的一个路由器docker0

所有容器在不指定--net的参数下，都是docker0路由，docker会给我们一个默认的可用ip。

![image-20210824125525112](/Users/jared/Library/Application Support/typora-user-images/image-20210824125525112.png)

> 小结

docker使用的是linux的桥接，宿主机中是一个docker容器的网桥docker0。

docker中所有的网络接口都是虚拟的，虚拟转发很快



## Docker容器互联

以上可知容器与容器是可以互相ping通的，但是是通过容器ip地址ping通的。如果容器重启，则ip就会改变，就不能使用原来的ip。因此需要实现通过容器名称来实现互联。

```
docker exec -it 38863174b ping tomcat02
连接失败
```

> **这就是--link参数来实现的**

```
# 用法
新容器名称 --link 被连接的容器名
docker run -d -P --name tomcat03 --link tomcat01 tomcat

此时就可以使用容器名称ping通
docker exec -it tomcat03 ping tomcat01

# 但是反向却不行，如果需要反向访问，同样需要进行配置
```



> 下面探究为什么不可以反向访问

```
docker network命令
使用docker network命令可以查看本机的网络情况

docker network ls			# 列出所有网络
docker network inspect  networkID		#查看该网络具体情况
```

```
docker network ls
bridge就是我们的docker0
```

![image-20210824193811848](/Users/jared/Library/Application Support/typora-user-images/image-20210824193811848.png)

```
docker network inspect networkID
```

![image-20210824193957692](/Users/jared/Library/Application Support/typora-user-images/image-20210824193957692.png)

![image-20210824194022529](/Users/jared/Library/Application Support/typora-user-images/image-20210824194022529.png)

```
docker inspect 容器id
查看某个容器的具体情况，可以看到tomcat03中有links是连接道到了tomcat01。但是没有与tomcat01相关的网络配置
```

![image-20210824194515373](/Users/jared/Library/Application Support/typora-user-images/image-20210824194515373.png)

```
进入tomcat03容器查看hosts文件
使用命令：
docker exec -it tomcat03 cat /etc/hosts

# 发现tomcat03的hosts文件夹下已经把tomcat01写死了
```

![image-20210824195648797](/Users/jared/Library/Application Support/typora-user-images/image-20210824195648797.png)

**hosts文件是啥**

***Hosts是一个没有扩展名的系统文件，可以用记事本等工具打开。其作用就是将一些常用的网址域名与其对应的IP地址建立一个关联“数据库”，当用户在浏览器中输入一个需要登录的网址时，系统会首先自动从Hosts文件中寻找对应的IP地址，一旦找到，系统会立即打开对应网页，如果没有找到，则系统会再将网址提交DNS域名解析服务器进行IP地址的解析。***



> --link的本质：
>
> 它本质上就是在hosts配置中增加了一个映射关系，所以可以通过容器名称ping。
>
> 不建议使用，比较笨
