# 容器数据卷

定义：如果数据都在容器中，如果容器删除，数据就会丢失！(==需求：数据可以持久化==)。所以容器之间可以有一个数据共享的技术，Docker容器中产生的数据，同步到本地，这就是卷技术：目录的挂载，将我们容器内的目录，挂载到主机上面

**总结一句话：容器的持久化和同步操作，容器之间也可以数据共享**



### 使用数据卷

```
方式一：使用命令来挂载 -v
这是一个双向的过程，无论是在容器内文件的更改，还是在主机上的更改，都会自动同步到另一方

docker run -it -v 主机目录：容器内目录
# 测试
docker run -it -v /home/ceshi:/home centos

# 启动起来后可以通过docker inspect命令查看挂载情况
```

**实战：将MySQL进行挂载**

```
docker run -d -p 8890:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name My_mysql mysql

# 解释
-e   表示环境配置
```



#### 匿名和具名挂载

```
# 匿名挂载
-v 容器内路径
docker run -d -P --name 容器名称 -v 容器内路径 镜像名称
docker run -d -P --name nginx01 -v /etc/nginx nginx


# 具名挂载
-v 卷名：容器内路径
docker run -d -P --name 容器名称 -v 卷名:容器内路径 镜像名称
ocker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx

# 指定路径挂载
-v /主机内路径:容器内路径


# 查看所有的卷
docker volume ls
# 查看这个卷
docker volume inspect 卷名
```

![image-20210822124449476](/Users/jared/Library/Application Support/typora-user-images/image-20210822124449476.png)

![image-20210822124859332](/Users/jared/Library/Application Support/typora-user-images/image-20210822124859332.png)

![image-20210822125107497](/Users/jared/Library/Application Support/typora-user-images/image-20210822125107497.png)

**所有的docker容器内的卷，没有指定卷名的情况下都是在==/var/lib/docker/volumes/xxx/_data==**

**通过具名挂载可以方便的找到我们的一个卷，大多数情况都是具名挂载**



```
# 如何确定是一个具名挂载还是匿名挂载或者是指定路径路径挂载？
-v		容器内路径								# 匿名挂载
-v		卷名：容器内路径					# 具名挂载
-v		/主机内路径：容器内路径		# 指定路径挂载

如果是指定路径挂载，则他的卷不会存储在_data中
```

拓展

```
# 通过 -v 容器内路径:ro rw改变读写权限
ro			readonly		#只读
rw			readwrite		#可读可写

# 一旦设置容器权限，容器对我们的挂载出来的内容就有权限限制了
docker run -d -P --name nginx01 -v juming-nginx:/etc/nginx:ro nginx
docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx

# ro表示，这个路径只能通过主机来操作，容器内部是无法操作的，因为只有可读权限
```



## 初识Dockerfile

dockerFile就是用来构建镜像的文件，命令脚本

通过这个脚本可以生成镜像，镜像是一层一层的，脚本的一个一个命令，都是一层

```
# 创建一个dockerfile文件，名字随机
# 文件内容：（命令都是大写的）
FROM centos
VOLUME ["volume01","volume02"]		# 表示匿名挂载
CMD echo "------end----"
CMD /bin/bash

# 编译（不要忘记后面有一个.):docker build

docker build -f dockerfile-1 -t own_centos:1.0 .
```

具体执行过程如下：

![image-20210823121306761](/Users/jared/Library/Application Support/typora-user-images/image-20210823121306761.png)

这就是我们设置的挂载目录，由于是匿名挂载，所以不知道卷名

![image-20210823121812431](/Users/jared/Library/Application Support/typora-user-images/image-20210823121812431.png)

可以通过docker inspect 容器id查看挂载情况

![image-20210823122035517](/Users/jared/Library/Application Support/typora-user-images/image-20210823122035517.png)

如果构建镜像的时候没有挂载卷，要手动挂载， -v 卷名：容器内路径



# 数据卷容器

容器之间的数据之间共享：使用--volumes-from参数

![image-20210823123115150](/Users/jared/Library/Application Support/typora-user-images/image-20210823123115150.png)



```
# 先新建一个容器
docker run -it --name centos01 own_centos:1.0
# 卷共享
docker run -it --name centos02 --volumes-from centos01 own_centos:1.0

# 以上2内就会把1内的数据给拷贝过来，如果说删除了容器1，2内的数据仍然存在，直到所有的容器都被删除，容器的共享数据才会被删除
# 当所有的容器都被删除了，他们的数据在容器内就不会存在了，但是同步到主机上的数据仍然存在
```

**结论**
容器之间数据卷共享可以实现容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。

不过数据如果持久化到了本地，那本地的数据是不会进行删除的

